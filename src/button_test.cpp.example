#include <TFT_eSPI.h>
#include <SPI.h>

// Button pins for TTGO T-Display
#define BUTTON_1 35
#define BUTTON_2 0

// Initialize display
TFT_eSPI tft = TFT_eSPI();

bool button1Pressed = false;
bool button2Pressed = false;
int screenColor = TFT_BLACK;

void setup() {
    Serial.begin(115200);
    Serial.println("TTGO T-Display Button Test");
    
    // Initialize buttons
    pinMode(BUTTON_1, INPUT);
    pinMode(BUTTON_2, INPUT);
    
    // Initialize the display
    tft.init();
    tft.setRotation(1); // Landscape orientation
    tft.fillScreen(screenColor);
    
    // Turn on backlight
    pinMode(4, OUTPUT);
    digitalWrite(4, HIGH);
    
    // Display instructions
    tft.setTextColor(TFT_WHITE, screenColor);
    tft.setTextSize(2);
    tft.setCursor(10, 10);
    tft.println("Button Test");
    tft.setCursor(10, 40);
    tft.println("BTN1: Change color");
    tft.setCursor(10, 70);
    tft.println("BTN2: Reset");
    
    Serial.println("Button test ready!");
}

void loop() {
    // Check button 1 (GPIO 35)
    if (digitalRead(BUTTON_1) == LOW && !button1Pressed) {
        button1Pressed = true;
        
        // Cycle through colors
        static int colorIndex = 0;
        uint16_t colors[] = {TFT_BLACK, TFT_RED, TFT_GREEN, TFT_BLUE, TFT_YELLOW, TFT_MAGENTA, TFT_CYAN};
        colorIndex = (colorIndex + 1) % 7;
        screenColor = colors[colorIndex];
        
        tft.fillScreen(screenColor);
        
        // Redraw text with contrasting color
        uint16_t textColor = (screenColor == TFT_BLACK || screenColor == TFT_BLUE) ? TFT_WHITE : TFT_BLACK;
        tft.setTextColor(textColor, screenColor);
        tft.setTextSize(2);
        tft.setCursor(10, 10);
        tft.println("Button Test");
        tft.setCursor(10, 40);
        tft.println("BTN1: Change color");
        tft.setCursor(10, 70);
        tft.println("BTN2: Reset");
        
        Serial.println("Button 1 pressed - Color changed");
        delay(200); // Debounce
    }
    
    // Check button 2 (GPIO 0) 
    if (digitalRead(BUTTON_2) == LOW && !button2Pressed) {
        button2Pressed = true;
        
        screenColor = TFT_BLACK;
        tft.fillScreen(screenColor);
        
        tft.setTextColor(TFT_WHITE, screenColor);
        tft.setTextSize(2);
        tft.setCursor(10, 10);
        tft.println("Button Test");
        tft.setCursor(10, 40);
        tft.println("BTN1: Change color");
        tft.setCursor(10, 70);
        tft.println("BTN2: Reset");
        
        Serial.println("Button 2 pressed - Reset to black");
        delay(200); // Debounce
    }
    
    // Reset button states when released
    if (digitalRead(BUTTON_1) == HIGH) {
        button1Pressed = false;
    }
    if (digitalRead(BUTTON_2) == HIGH) {
        button2Pressed = false;
    }
    
    delay(50); // Small delay for stability
}