#include <TFT_eSPI.h>
#include <SPI.h>

TFT_eSPI tft = TFT_eSPI();

// Simple 16x16 smiley face in XBM format (monochrome bitmap)
const unsigned char smiley_bits[] PROGMEM = {
    0x00, 0x00, 0xe0, 0x07, 0x18, 0x18, 0x04, 0x20, 0x02, 0x40, 0x82, 0x41,
    0x82, 0x41, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x42, 0x42, 0x84, 0x21,
    0x08, 0x10, 0x10, 0x08, 0xe0, 0x07, 0x00, 0x00};

// 24x24 heart icon
const unsigned char heart_bits[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x1c, 0x00, 0xf8, 0x3e, 0x00,
    0xfc, 0x7f, 0x00, 0xfe, 0xff, 0x00, 0xff, 0xff, 0x01, 0xff, 0xff, 0x01,
    0xff, 0xff, 0x01, 0xfe, 0xff, 0x00, 0xfc, 0x7f, 0x00, 0xf8, 0x3f, 0x00,
    0xf0, 0x1f, 0x00, 0xe0, 0x0f, 0x00, 0xc0, 0x07, 0x00, 0x80, 0x03, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

void drawXBM(int16_t x, int16_t y, int16_t w, int16_t h, const unsigned char *bitmap, uint16_t color, uint16_t bg)
{
    int16_t byteWidth = (w + 7) / 8;
    uint8_t byte = 0;

    for (int16_t j = 0; j < h; j++)
    {
        for (int16_t i = 0; i < w; i++)
        {
            if (i & 7)
                byte <<= 1;
            else
                byte = pgm_read_byte(&bitmap[j * byteWidth + i / 8]);

            if (byte & 0x80)
                tft.drawPixel(x + i, y + j, color);
            else
                tft.drawPixel(x + i, y + j, bg);
        }
    }
}

void demoXBMImages()
{
    tft.fillScreen(TFT_NAVY);

    tft.setTextColor(TFT_WHITE, TFT_NAVY);
    tft.setTextFont(2);
    tft.setCursor(5, 5);
    tft.println("XBM Images:");

    // Draw smiley faces in different colors
    for (int i = 0; i < 5; i++)
    {
        uint16_t colors[] = {TFT_YELLOW, TFT_GREEN, TFT_CYAN, TFT_MAGENTA, TFT_WHITE};
        drawXBM(20 + i * 40, 30, 16, 16, smiley_bits, colors[i], TFT_NAVY);
    }

    // Draw hearts
    for (int i = 0; i < 4; i++)
    {
        uint16_t colors[] = {TFT_RED, TFT_PINK, TFT_ORANGE, TFT_PURPLE};
        drawXBM(30 + i * 50, 70, 24, 24, heart_bits, colors[i], TFT_NAVY);
    }
}

void demoProceduralGraphics()
{
    tft.fillScreen(TFT_BLACK);

    tft.setTextColor(TFT_WHITE, TFT_BLACK);
    tft.setTextFont(2);
    tft.setCursor(5, 5);
    tft.println("Procedural Graphics:");

    // Draw a gradient
    for (int x = 0; x < 240; x++)
    {
        uint16_t color = tft.color565(x / 2, 255 - x / 2, 128);
        tft.drawFastVLine(x, 30, 20, color);
    }

    // Draw a mandala pattern
    int centerX = 120, centerY = 80;
    for (int angle = 0; angle < 360; angle += 10)
    {
        float rad = radians(angle);
        int x1 = centerX + 30 * cos(rad);
        int y1 = centerY + 30 * sin(rad);
        int x2 = centerX + 20 * cos(rad * 3);
        int y2 = centerY + 20 * sin(rad * 3);

        uint16_t color = tft.color565(255 * sin(rad), 255 * cos(rad), 128);
        tft.drawLine(x1, y1, x2, y2, color);
    }
}

void drawPixelSprite(int x, int y, uint16_t sprite[8][8], int scale)
{
    for (int j = 0; j < 8; j++)
    {
        for (int i = 0; i < 8; i++)
        {
            if (sprite[j][i] != 0)
            {
                if (scale == 1)
                {
                    tft.drawPixel(x + i, y + j, sprite[j][i]);
                }
                else
                {
                    tft.fillRect(x + i * scale, y + j * scale, scale, scale, sprite[j][i]);
                }
            }
        }
    }
}

void demoPixelArt()
{
    tft.fillScreen(TFT_BLACK);

    tft.setTextColor(TFT_WHITE, TFT_BLACK);
    tft.setTextFont(2);
    tft.setCursor(5, 5);
    tft.println("Pixel Art:");

    // Draw a simple 8x8 sprite (mushroom-like)
    uint16_t sprite[8][8] = {
        {0, 0, TFT_RED, TFT_RED, TFT_RED, TFT_RED, 0, 0},
        {0, TFT_RED, TFT_WHITE, TFT_RED, TFT_RED, TFT_WHITE, TFT_RED, 0},
        {TFT_RED, TFT_WHITE, TFT_RED, TFT_RED, TFT_RED, TFT_RED, TFT_WHITE, TFT_RED},
        {TFT_RED, TFT_RED, TFT_RED, TFT_RED, TFT_RED, TFT_RED, TFT_RED, TFT_RED},
        {0, 0, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, 0, 0},
        {0, 0, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, 0, 0},
        {0, 0, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, TFT_YELLOW, 0, 0},
        {0, TFT_BROWN, TFT_BROWN, 0, 0, TFT_BROWN, TFT_BROWN, 0}};

    // Draw multiple copies at different scales
    drawPixelSprite(50, 40, sprite, 3);  // 3x scale
    drawPixelSprite(150, 50, sprite, 2); // 2x scale
    drawPixelSprite(200, 60, sprite, 1); // 1x scale
}

void setup()
{
    Serial.begin(115200);

    tft.init();
    tft.setRotation(1);
    tft.fillScreen(TFT_BLACK);

    // Turn on backlight
    pinMode(4, OUTPUT);
    digitalWrite(4, HIGH);

    Serial.println("Image Demo Starting...");
}

void loop()
{
    // Demo XBM images
    demoXBMImages();
    delay(3000);

    // Demo procedural graphics
    demoProceduralGraphics();
    delay(3000);

    // Demo pixel art
    demoPixelArt();
    delay(3000);
}
